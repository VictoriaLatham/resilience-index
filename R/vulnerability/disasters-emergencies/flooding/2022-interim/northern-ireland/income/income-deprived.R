library(dplyr)
library(readxl)
# library(IMD)

source("R/utils.R")  # for download_file()

# Fetch underlying indicators of deprivation from https://www.nisra.gov.uk/publications/nimdm17-soa-level-results
tf_indicators <- 
  download_file("https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/NIMDM17_SOAresults.xls", ".xls")

raw <-
  read_excel(
    tf_indicators,
    sheet = "Income"
  )

# Population income deprived
income_deprived <- 
  raw %>% 
  select(soa_code = SOA2001, proportion_income_deprived = `Proportion of the population living in households whose equivalised income is below 60 per cent of the NI median 
(%)`)

# Save
income_deprived %>% 
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/northern-ireland/ability-to-prepare/income-deprived-lsoa.rds")

income_deprived %>% 
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/northern-ireland/ability-to-respond/income-deprived-lsoa.rds")

income_deprived %>% 
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/northern-ireland/ability-to-recover/income-deprived-lsoa.rds")
