library(readr)
library(tidyr)
library(dplyr)
library(readxl)
library(stringr)
library(geographr)

caci_demographics <-
  read_excel(
    "data/on-disk/caci/demographics.xlsx",
    skip = 10
  )

low_income_occupations <-
  caci_demographics |>
  filter(str_detect(LSOA, "^W")) |>
  select(
    lsoa_code = LSOA,
    routine_occupations = `7. Routine Occupations`,
    semi_routine_occupations = `6. Semi-Routine Occupations`,
    num_working_age = `Persons 16-74...20`
  ) |>
  mutate(
    low_income_occupations = routine_occupations + semi_routine_occupations,
    proportion_low_income_occupations = low_income_occupations / num_working_age
  ) |>
  select(lsoa_code, proportion_low_income_occupations)

# Save
low_income_occupations |>
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/wales/ability-to-prepare/low-income-occupations-lsoa.rds")

low_income_occupations |>
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/wales/ability-to-respond/low-income-occupations-lsoa.rds")

low_income_occupations |>
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/wales/ability-to-recover/low-income-occupations-lsoa.rds")