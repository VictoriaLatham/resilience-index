# Load packages
library(readxl)

source("R/utils.R") # for download_file()

# Source: https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020v2-indicator-data/
tf <- download_file(
  "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2020/01/scottish-index-of-multiple-deprivation-2020-indicator-data/documents/simd_2020_indicators/simd_2020_indicators/govscot%3Adocument/SIMD%2B2020v2%2B-%2Bindicators.xlsx",
  ".xlsx"
)

raw <- read_excel(tf, sheet = "Data")

# Recorded crimes of violence, sexual offences, domestic housebreaking, vandalism, drugs offences, and common assault per 10,000 people
# Data have been suppressed for some indicators for reasons of disclosure control where small numbers are involved. This is also indicated by '*'. 
# Assumption: set these small numbers to be 0
crime <-
  raw |>
  select(dz_code = Data_Zone, crime_rate) |>
  mutate(crime_rate = if_else(crime_rate == "*", 0, as.numeric(crime_rate)))

# Save
crime |>
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/scotland/ability-to-respond/crime-dz.rds")