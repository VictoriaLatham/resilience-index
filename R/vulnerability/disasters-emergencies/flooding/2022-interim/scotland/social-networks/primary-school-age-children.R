# Load packages
library(tidyr)
library(dplyr)
library(stringr)
library(demographr)

# Calculate school children ages (4-11) proportions for datazones
primary_school_children_dz <- 
  population_dz_20 |> 
  filter(sex == "All") |>
  pivot_longer(cols = `0`:`90+`, names_to = "Age", values_to = "n_people") %>%
  mutate(Age = as.integer(str_extract(Age, "[0-9]+"))) %>%
  group_by(dz_code) %>%
  summarise(
    num_people = sum(n_people),
    num_primary_school = sum(n_people[Age >= 4 & Age <= 11], na.rm = TRUE)
  ) %>%
  mutate(proportion_primary_school_age = num_primary_school / num_people) %>% 
  select(dz_code, proportion_primary_school_age)

# Save
primary_school_children_dz %>%
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/scotland/community-support/primary-school-children-dz.rds")
