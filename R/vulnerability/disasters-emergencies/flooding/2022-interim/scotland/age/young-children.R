# Load packages 
library(readr)
library(tidyr)
library(dplyr)
library(stringr)
library(demographr)

source("R/utils.R") # for download_file()

# Calculate older population (aged 5 or younger) proportions for Datazones
# 3 Datazones with no population 
younger_dz <- 
  population_dz_20 |> 
  filter(sex == "All") |>
  pivot_longer(cols = `0`:`90+`, names_to = "Age", values_to = "n_people") |>
  mutate(Age = as.integer(str_extract(Age, "[0-9]+"))) |>
  group_by(dz_code) |>
  summarise(
    num_people = sum(n_people),
    num_people_under_5 = sum(n_people[Age <= 5], na.rm = TRUE)
  ) |>
  mutate(proportion_under_5 = num_people_under_5 / num_people) 

# Save
younger_dz %>%
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/scotland/susceptibility/younger-population-dz.rds")
