library(dplyr)
library(geographr)

# Load z-scores for each vulnerability indicator
caci_vulnerability <- 
  read_csv(
    "C:/Users/040026704/British Red Cross Society/Strategic Insight and Foresight - Documents/Data/CACI/vul_zscores.csv"
  )

living_in_care_establishments <- 
  caci_vulnerability %>% 
  select(
    postcode, 
    proportion_residing_in_hospitals_or_care_homes_z = vul_hlt_com
  ) %>% 
  
  mutate(postcode = gsub(" ", "", postcode)) %>% 
  
  left_join(lookup_postcode_lsoa_msoa_lad) %>% 
  
  group_by(lsoa_code) %>% 
  summarise(proportion_residing_in_hospitals_or_care_homes_z = sum(proportion_residing_in_hospitals_or_care_homes_z, na.rm = TRUE)) %>% 
  ungroup() 

# Keep only England's LSOAs
living_in_care_establishments <- 
  living_in_care_establishments %>% 
  filter(str_detect(lsoa_code, "^E"))

# Save
living_in_care_establishments %>%
  write_rds("data/vulnerability/disasters-emergencies/flooding/2022-interim/england/living-in-care-establishments-lsoa.rds")
