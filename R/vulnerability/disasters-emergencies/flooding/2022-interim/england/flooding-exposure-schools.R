library(dplyr)
library(readr)
library(geographr)
library(stringr)

flood_risk_oa <- read_rds("data/vulnerability/disasters-emergencies/flooding/flood-risk-output-areas.rds")

# Schools data from https://www.compare-school-performance.service.gov.uk/download-data
schools <- read_csv("https://www.compare-school-performance.service.gov.uk/download-data?download=true&regions=0&filters=GIAS&fileformat=csv&year=2020-2021&meta=false")

# Get each school's Output Area - how many schools are in Output Areas at risk of flooding?
schools_oa <- 
  schools %>% 
  select(postcode = POSTCODE) %>% 
  mutate(postcode = gsub(" ", "", postcode)) %>% 
  left_join(lookup_postcode_oa_lsoa_msoa_lad) %>% 
  count(oa_code) %>% 
  left_join(flood_oa)
