library(tidyverse)
library(geographr)
library(sf)

source("R/utils.R")

lookup <-
  lookup_sa_soa_lgd |>
  distinct(soa_code, lad_code = lgd_code)

# Calculate elderly population proportions for SOAs
elderly_soa <-
  population_soa |>
  filter(sex == "All") |>
  rename(
    num_people = total_population,
    num_people_over_65 = `65+`
  ) |>
  mutate(proportion_over_65 = num_people_over_65 / num_people) |>
  select(soa_code, proportion_over_65, num_people)

# For LAD, calculate extent on proportions
elderly <-
  elderly_soa |>
  left_join(lookup) |>
  calculate_extent_depreciated(
    proportion_over_65,
    higher_level_geography = lad_code,
    population = num_people
  ) |>
  rename(eldlery = extent)

elderly %>%
  write_rds("data/vulnerability/disasters-emergencies/northern-ireland/elderly-population.rds")