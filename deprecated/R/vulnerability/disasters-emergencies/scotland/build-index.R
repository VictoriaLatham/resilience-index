# ---- Load libraries and Functions ----
library(tidyverse)
source("R/utils.R")

# ---- Load indicators ----
disabilities <-
  read_rds("data/vulnerability/disasters-emergencies/scotland/disability-lad.rds") %>%
  select(
    lad_code,
    raw_disability = disability_daily_activities_percent
  )

imd <-
  read_rds("data/vulnerability/disasters-emergencies/scotland/imd-lad.rds") %>%
  select(
    lad_code,
    raw_imd = extent
  )

living_alone <-
  read_rds("data/vulnerability/disasters-emergencies/scotland/living-alone-lad.rds") %>%
  select(
    lad_code,
    raw_living_alone = extent
  )

elderly <-
  read_rds("data/vulnerability/disasters-emergencies/scotland/elderly-population-lad.rds") %>%
  select(
    lad_code,
    raw_elderly = extent
  )

# ---- Build Index ----
de <-
  disabilities %>%
  left_join(imd) %>%
  left_join(living_alone) %>%
  left_join(elderly) %>%
  normalise_indicators() %>%
  calculate_domain_scores(domain_name = "de") %>%
  select(lad_code, deciles = de_domain_quantiles)

de %>%
  write_csv("data/vulnerability/disasters-emergencies/scotland/de-index.csv")